services:
  es-relevance-studio-server:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 4096:4096
    env_file:
      - .env
  es-relevance-studio-worker:
    build:
      context: .
      dockerfile: Dockerfile
    command: ["python", "-m", "server.worker"]
    env_file:
      - .env
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
          condition: on-failure