services:
  esrs-server:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 4096:4096
    env_file:
      - .env
  esrs-worker:
    build:
      context: .
      dockerfile: Dockerfile
    command: ["python", "-m", "server.worker"]
    env_file:
      - .env
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
          condition: on-failure
  esrs-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile-mcp
    ports:
      - 4200:4200
    env_file:
      - .env
  esrs-mcp-proxy:
    build:
      context: .
      dockerfile: Dockerfile-mcp
      network: host
    command: ["python", "-m", "server.fastmcp_proxy"]
    stdin_open: true
    tty: true
    environment:
      - FASTMCP_DEBUG=true
    env_file:
      - .env
    network_mode: host